<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-button/paper-button.html">

<link rel="import" href="../iron-label/iron-label.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">

<link rel="import" href="../oc-option-sets-list/oc-option-sets-list.html">

<!--
`oc-edit-option`
Element for editing an option

@demo demo/index.html 
-->

<dom-module id="oc-edit-option">
  <style>
    :host {
      display: block;
    }
    paper-material {
      background-color: #fff;
      padding: 10px;
    }
  </style>

  <template>
    <paper-material>
      <paper-input id="nameInput" label="Name">[[ _optionName ]]</paper-input>
      <paper-input id="descriptionInput" label="Description">[[ _optionDescription ]]</paper-input>
      <paper-input id="priceInput" label="Price">[[ _optionPrice ]]</paper-input>
      <div>Unlocks Options</div>
      <paper-button id="unlockOptionSetsSummary" on-tap="_unlockOptionsTapped">Add some</paper-button>
      <iron-collapse opened$="[[ _showOptionSetsList ]]">
        <oc-option-sets-list
                id="optionSetsList"
                actions-hidden
                on-page-changed="_onOptionSetsPageChange"
                multiselect
                on-item-selected="_onOptionSetSelected"
                on-item-deselected="_onOptionSetDeselected"
        ></oc-option-sets-list>
      </iron-collapse>
      <div>Unlocks Extras</div>
      <paper-button id="unlockExtraSetsSummary" on-tap="_unlockExtrasTapped">Add Some</paper-button>
      <iron-collapse opened$="[[ _showExtraSetsList ]]">
        <div>TODO</div>
      </iron-collapse>
      <paper-button on-tap="_saveTapped" >Save</paper-button>
    </paper-material>
  </template>

  <script>
    Polymer({

      is: 'oc-edit-option',

      properties: {
      },

      observers: [
        'refresh(organisationId, optionId)'
      ],

      setOption: function(option) {
        this._option = option;
        this.$.nameInput.value = option.name;
        this.$.descriptionInput.value = option.description;
        this.$.priceInput.value = option.price;
        this._setUnlockOptionSetsSummary(this._option.unlockOptionSets);
        this._setUnlockExtraSetsSummary(this._option.unlockExtraSets);
      },

      _setUnlockOptionSetsSummary: function(unlockOptionSets) {
        this.$.unlockOptionSetsSummary.value = unlockOptionSets.reduce(
                function(prevValue, currentValue, currentIndex, array) {
                  return prevValue + "; " + currentValue;
                });
      },

      _setUnlockExtraSetsSummary: function(unlockExtraSets) {
        this.$.unlockExtraSetsSummary.value = unlockExtraSets.reduce(
                function(prevValue, currentValue, currentIndex, array) {
                  return prevValue + "; " + currentValue;
                });
      },

      _setOptionSetItems(optionSetItems, totalItems, page) {
        // ToDo: select the ones in this._option.unlockOptionSets
        this.$.optionSetsList.setItems(optionSetItems);
        this.$.optionSetsList.setTotalItems(totalItems);
        this.$.optionSetsList.setPage(page);
      },

      _setExtraSetItems(extraSetItems, totalItems, page) {
        // ToDo
        // ToDo: select the ones in this._option.unlockOptionSets
      },

      _unlockOptionsTapped: function() {
        this._showOptionSetsList = !this._showOptionSetsList;
      },

      _unlockExtrasTapped: function() {
        this._showExtraSetsList = !this._showExtraSetsList;
      },

      _onOptionSetsPageChange: function(event) {
        this.fire('unlock-option-sets-page-changed')
      },

      _onOptionSetSelected: function(event) {
        this._option.unlockOptionSets.push(event.detail);
        this._setUnlockOptionSetsSummary(this._option.unlockOptionSets);
      },

      _onOptionSetDeselected: function(event) {
        this._option.unlockOptionSets.remove(event.detail);
        this._setUnlockOptionSetsSummary(this._option.unlockOptionSets);
      },

      _onExtraSetsPageChange: function(event) {
        this.fire('unlock-extra-sets-page-changed')
      },

      _onExtraSetSelected: function(event) {
      },

      _onExtraSetDeselected: function(event) {
      },

      _saveTapped: function() {
        this.fire('save');
      },

      getOption: function() {
        return this._option;
      }

    });
  </script>
</dom-module>
